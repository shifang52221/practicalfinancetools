---
import BaseLayout from "./BaseLayout.astro";
import AdSlot from "../components/AdSlot.astro";
import { SITE } from "../config/site";

type FAQ = { q: string; a: string };

type Props = {
  title: string;
  description: string;
  canonicalPath: string;
  intro: string;
  how: string[];
  faqs: FAQ[];
  lastUpdated: string;
};

const { title, description, canonicalPath, intro, how, faqs, lastUpdated } = Astro.props;
const slots = SITE.adsenseSlots;

const siteUrl = Astro.site ? Astro.site.toString() : SITE.url;
const pageUrl = new URL(canonicalPath, siteUrl).toString();
const calculatorsUrl = new URL("/calculators", siteUrl).toString();

const breadcrumbLd = {
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  itemListElement: [
    { "@type": "ListItem", position: 1, name: "Home", item: siteUrl },
    { "@type": "ListItem", position: 2, name: "Calculators", item: calculatorsUrl },
    { "@type": "ListItem", position: 3, name: title, item: pageUrl }
  ]
};

const faqLd =
  faqs.length > 0
    ? {
        "@context": "https://schema.org",
        "@type": "FAQPage",
        mainEntity: faqs.map((f) => ({
          "@type": "Question",
          name: f.q,
          acceptedAnswer: { "@type": "Answer", text: f.a }
        }))
      }
    : null;

const webPageLd = {
  "@context": "https://schema.org",
  "@type": "WebPage",
  name: title,
  description,
  url: pageUrl
};
---
<BaseLayout title={title} description={description} canonicalPath={canonicalPath}>
  <Fragment slot="head">
    <script type="application/ld+json" set:html={JSON.stringify(webPageLd)} />
    <script type="application/ld+json" set:html={JSON.stringify(breadcrumbLd)} />
    {faqLd ? <script type="application/ld+json" set:html={JSON.stringify(faqLd)} /> : null}
  </Fragment>

  <section class="card hero">
    <nav class="breadcrumbs" aria-label="Breadcrumb">
      <a href="/">Home</a>
      <span aria-hidden="true">/</span>
      <a href="/calculators">Calculators</a>
      <span aria-hidden="true">/</span>
      <span aria-current="page">{title}</span>
    </nav>
    <h1>{title}</h1>
    <p>{intro}</p>
  </section>

  <section class="card section">
    <slot />
  </section>

  <section class="section">
    <AdSlot slot={slots.calculatorMid} minHeight={280} />
  </section>

  <section class="card section prose">
    <h2 style="margin-top:0">How we calculate</h2>
    <ul class="muted" style="margin:8px 0 0; padding-left:18px">
      {how.map((line) => (
        <li>{line}</li>
      ))}
    </ul>
  </section>

  <section class="card section prose">
    <h2 style="margin-top:0">FAQ</h2>
    {faqs.map((f) => (
      <details class="card2" style="padding:12px; margin:10px 0">
        <summary style="cursor:pointer; font-weight:800">{f.q}</summary>
        <div class="muted" style="margin-top:8px">{f.a}</div>
      </details>
    ))}
  </section>

  <section class="section">
    <AdSlot slot={slots.calculatorBottom} minHeight={280} />
  </section>

  <section class="card section prose">
    <h2 style="margin-top:0">Disclaimer</h2>
    <p class="muted" style="margin:0">
      Educational use only. Not financial advice. Results are estimates based on the inputs and assumptions shown on
      this page. Verify details with lenders, card issuers, and professionals.
    </p>
    <p class="muted" style="margin:10px 0 0">Last updated: {lastUpdated}</p>
  </section>
</BaseLayout>
